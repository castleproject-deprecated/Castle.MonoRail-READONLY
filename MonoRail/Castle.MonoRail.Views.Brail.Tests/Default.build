<?xml version="1.0"?>
<project name="Brail.Tests" default="deploy">
	<property name="build.dir" value="${website}\bin" />
	
	<target name="init">
		<mkdir dir="${build.dir}" />
	</target>
		
	<target name="libraries">
		<copy todir="${build.dir}" flatten="true" overwrite="false" failonerror="false">
			<fileset basedir="${vendor.dir}">
				<include name="nunit.framework.dll" />
				<include name="Cassini.dll" />
				<include name="Castle.MonoRail.Engine.dll"/>
				<include name="Castle.MonoRail.Engine.Tests.Dll"/>
				<include name="Castle.MonoRail.Framework.Dll"/>
			</fileset>
		</copy>
	</target>

	<target name="build" depends="init, libraries">		
		<booc target="library" 
		      output="${build.dir}\Castle.MonoRail.Views.Brail.Tests.dll" 
		      debug="${build.debug}">
			<sources basedir="${nant.project.basedir}">
				<include name="**/*.boo" />
				<include name="${website}\common-asm-info.boo"/>
				<exclude name="Views/**.boo" />
			</sources>
			<references basedir="${build.dir}">
				<include name="Castle.MonoRail.Views.Brail.dll" />
				<include name="Boo.Lang.Useful.dll" />
				<include name="nunit.framework.dll" />
				<include name="Castle.MonoRail.Engine.Dll"/>
				<include name="Castle.MonoRail.Engine.Tests.Dll"/>
				<include name="Castle.MonoRail.Framework.Dll"/>
				<include name="System.Web.dll"/>
			</references>
			<resources basedir="${nant.project.basedir}\Resources">
				<include name="**.resources"/>
			</resources>
		</booc>
	</target>

	<target name="deploy" depends="build">
		<copy todir="${website}">
			<fileset basedir="${nant.project.basedir}">
				<include name="Views/**.boo"/>
				<include name="Web.config"/>
				<include name="Global.asax"/>
			</fileset>
		</copy>
	</target>

	<target name="test">
		<exec program="NUnit-Console.exe">
			<arg value="${build.dir}\Castle.MonoRail.Views.Brail.Tests.dll"/>
		</exec>
	</target>
	
</project>
